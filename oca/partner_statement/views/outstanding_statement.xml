<?xml version="1.0" encoding="utf-8" ?>
<!-- Copyright 2018 ForgeFlow, S.L. (https://www.forgeflow.com)
     License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl). -->
<odoo>
    <template id="outstanding_balance">
        <p>
            <span
            t-out="'' if  account_type == 'asset_receivable' else 'Supplier '"
        /><span t-out="title_name" />
<!--            up to <span t-out="ending_date" /> -->
            in <span
            t-out="display_currency.name"
        />
        </p>
        <table class="table table-sm table-statement">
            <thead>
                <tr style="border: 1px solid black;">
                    <th><strong>Date</strong></th>
                    <th style="white-space: nowrap;"><strong>Invoice No.</strong></th>
                    <th><strong>D.O.</strong></th>
                    <th style="white-space: nowrap;"><strong>Customer Ref </strong></th>
                    <th style="white-space: nowrap;"><strong>Project Ref </strong></th>
                    <th style="white-space: nowrap;"><strong>Ordered By </strong></th>
                    <th class="amount" style="white-space: nowrap;"><strong>Open Amount </strong></th>
                    <th class="amount"><strong>Balance </strong></th>
                </tr>
            </thead>
            <tbody>
                <tr t-foreach="currency[line_type]" t-as="line">
                    <td>
                        <span t-out="line['date']"/>
                    </td>
                    <td>
                        <span t-out="line['move_id']" />
                    </td>
                    <td>
                        <span t-out="', '.join(env['account.move'].search([('name', '=', line['move_id'])], limit=1).ac_picking_ids.mapped('name')) if line['move_id'] else ''"/>
                    </td>
                    <td>
                        <span t-out="line['ref']" />
                    </td>
                    <td style="display:block; min-width:120px; white-space:normal;">
                        <span t-out="(line['move_id'] and env['account.move'].search([('name', '=', line['move_id'])], limit=1).project)"/>
                    </td>
                    <td>
                        <span t-out="(line['move_id'] and env['account.move'].search([('name', '=', line['move_id'])], limit=1).attention_id.name)"/>
                    </td>
                    <td class="amount">
                        <span
                            t-out="line['open_amount']"
                            t-options="{'widget': 'monetary', 'display_currency': display_currency}"
                        />
                    </td>
                    <td class="amount">
                        <span
                            t-out="line['balance']"
                            t-options="{'widget': 'monetary', 'display_currency': display_currency}"
                        />
                    </td>
                </tr>
<!--                    <tr>-->
<!--                        <td />-->
<!--                        <td>-->
<!--                            <strong><span t-out="ending_date" /></strong>-->
<!--                        </td>-->
<!--                        <td>-->
<!--                            <strong>Ending Balance</strong>-->
<!--                        </td>-->
<!--                        <td />-->
<!--                        <td />-->
<!--                        <td />-->
<!--                        <td class="amount">-->
<!--                            <strong>-->
<!--                                <span-->
<!--                                    t-out="ending_amount"-->
<!--                                    t-options="{'widget': 'monetary', 'display_currency': display_currency}"-->
<!--                                />-->
<!--                            </strong>-->
<!--                        </td>-->
<!--                    </tr>-->
            </tbody>
        </table>
    </template>
    <template id="partner_statement.outstanding_statement_document">
        <t t-call="web.external_layout">
            <t t-set="o" t-value="o.with_context({'lang': lang})" />
            <div class="page">
                <div id="oe_structure" class="oe_structure" />
                <h2><center><b>Statement of Account</b></center></h2>
                <h4><center>as at <t t-esc="d['end']"/></center></h4>
                <div id="informations" class="row mt32 mb32">

                    <div class="col-6 bm-2">
                        <div>
                            <p t-field="o.name" class="m-0" style="font-size: 18px; font-weight: bold;"/>
                        </div>
                        <div>
                            <address t-esc="o" t-options='{"widget": "contact", "fields": ["address"], "no_marker": True}'/>
                        </div>

                    </div>

                    <div class="col-6 bm-2" style="padding-left: 200px;">
                        <div style="display: flex; flex-direction: column; gap: 2px; line-height: 1.4;">
                            <div style="display: flex;">
                                <strong style="width: 50px; display: inline-block;">Tel</strong>
                                <span>:</span>
                                <span style="margin-left: 6px;" t-field="o.phone"/>
                            </div>

                            <div style="display: flex;">
                                <strong style="width: 50px; display: inline-block;">Attn</strong>
                                <span>:</span>
                                <span style="margin-left: 6px;">A/C DEPT</span>
                            </div>

                            <div style="display: flex;">
                                <strong style="width: 50px; display: inline-block;">Term</strong>
                                <span>:</span>
                                <span style="margin-left: 6px;" t-field="o.property_payment_term_id"/>
                            </div>
                        </div>
                    </div>
                </div>
                <t t-if="d['currencies']">
                    <br />
                    <t t-foreach="d['currencies'].items()" t-as="currency">
                        <t t-set="display_currency" t-value="Currencies[currency[0]]" />
                        <t t-set="currency" t-value="currency[1]" />
                        <t t-set="line_type" t-value="'lines'" />
                        <t t-set="title_name" t-value="'Statement'" />
                        <t t-set="ending_amount" t-value="currency['amount_due']" />
                        <t t-set="ending_date" t-value="d['end']" />
                        <t
                            t-call="partner_statement.outstanding_balance"
                            name="outstanding"
                        />
                        <t
                            t-call="partner_statement.aging_buckets"
                            t-if="currency['buckets']"
                        />
                    </t>
                </t>
                <p t-if="d.get('no_entries')">
                    <strong>The partner doesn't have due entries.</strong>
                </p>
            </div>
            <div>
                <br/>
                <p>Your account is overdue, we shall be grateful if you will let us have the payment as soon as
                    possible.
                </p>
                <p>Please ignore this statement of account if you had arrange payment after the date shown. If there are
                    any questions or you are missing any of the invoices please let us know.
                </p>
            </div>
        </t>
    </template>
    <template id="outstanding_statement">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-set="d" t-value="data.get(o.id)" />
                <t
                    t-call="partner_statement.outstanding_statement_document"
                    t-lang="o.lang"
                />
            </t>
        </t>
    </template>
    <record id="action_print_outstanding_statement" model="ir.actions.report">
        <field name="name">Outstanding Statement</field>
        <field name="model">res.partner</field>
        <field name="report_name">partner_statement.outstanding_statement</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_file">partner_statement.outstanding_statement</field>
    </record>
    <record id="action_print_outstanding_statement_html" model="ir.actions.report">
        <field name="name">Outstanding Statement</field>
        <field name="model">res.partner</field>
        <field name="report_name">partner_statement.outstanding_statement</field>
        <field name="report_type">qweb-html</field>
        <field name="report_file">partner_statement.outstanding_statement</field>
    </record>
    <record id="action_print_outstanding_statement_xlsx" model="ir.actions.report">
        <field name="name">Outstanding Statement XLSX</field>
        <field name="model">res.partner</field>
        <field name="type">ir.actions.report</field>
        <field name="report_name">p_s.report_outstanding_statement_xlsx</field>
        <field name="report_type">xlsx</field>
        <field name="report_file">report_outstanding_statement</field>
    </record>
</odoo>
