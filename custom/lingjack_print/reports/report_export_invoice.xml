<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_export_invoice_document" inherit_id="lingjack_print.report_tax_invoice_document"
              primary="True">
        <xpath expr="//h2" position="replace">
            <h2 class="text-left" style="text-align: center; color: #1f4e79; margin-top:50px;">
                <span style="font-size: 28px;">
                    EXPORT INVOICE
                </span>
            </h2>
        </xpath>

        <xpath expr="//table[@class='table table-borderless']" position="replace">
            <table style="width: 85%;" class="table table-borderless">
                <tr>
                    <td style="padding: 2px 4px;">Attn</td>
                    <td style="padding: 2px 4px;">:</td>
                    <td style="padding: 2px 4px;white-space: nowrap;">
                        <span t-field="o.attention_id.name"/>
                    </td>
                </tr>
                <tr>
                    <td style="padding: 2px 4px;">Tel</td>
                    <td style="padding: 2px 4px;">:</td>
                    <td style="padding: 2px 4px;">
                        <span t-field="o.attention_id.phone"/>
                    </td>
                </tr>
                <tr>
                    <td colspan="3" style="height: 40px;"></td>
                </tr>
            </table>
        </xpath>

        <xpath expr="//tr[td/table[@class='table table-borderless']]" position="after">

            <table style="width: 100%; margin-top: -4%;" class="table-borderless">
                <tr>
                    <td style="width: 50%; padding: 2px 0px;">
                        <table style="width: 100%;" class="table-borderless">
                            <tr>
                                <td style="padding: 2px 4px; white-space: nowrap;">Shipper</td>
                                <td style="padding: 2px 4px;">:</td>
                                <td style="padding: 2px 4px;">
                                    <span t-field="o.shipper_id"/>
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 2px 4px; white-space: nowrap;">Shipper Address</td>
                                <td style="padding: 2px 4px;">:</td>
                                <td style="padding: 2px 4px;">
                                    <span t-field="o.shipper_id"
                                          t-options="{'widget': 'contact', 'fields': ['address'], 'no_marker': true }"/>
                                </td>
                            </tr>
                        </table>
                    </td>

                    <td style="width: 4%;"></td>

                    <td style="width: 50%; padding: 2px 0px;">
                        <table style="width: 100%;" class="table-borderless">
                            <tr>
                                <td style="padding: 2px 4px;">Consignee</td>
                                <td style="padding: 2px 4px;">:</td>
                                <td style="padding: 2px 4px;">
                                    <span t-field="o.consignee_id"/>
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 2px 4px; white-space: nowrap;">Consignee Address</td>
                                <td style="padding: 2px 4px;">:</td>
                                <td style="padding: 2px 4px;">
                                    <span t-field="o.consignee_id"
                                          t-options="{'widget': 'contact', 'fields': ['address'], 'no_marker': true } "/>
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 2px 4px; white-space: nowrap;">Contact Person</td>
                                <td style="padding: 2px 4px;">:</td>
                                <td style="padding: 2px 4px;">
                                    <span t-field="o.consignee_contacts_id.name"/>
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 2px 4px; white-space: nowrap;">Contact Number</td>
                                <td style="padding: 2px 4px;">:</td>
                                <td style="padding: 2px 4px;">
                                    <span t-field="o.consignee_contacts_id.mobile"/>
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 2px 4px; white-space: nowrap;">Email</td>
                                <td style="padding: 2px 4px;">:</td>
                                <td style="padding: 2px 4px;">
                                    <span t-field="o.consignee_contacts_id.email"/>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>

            <table class="table-borderless">
                <tr>
                    <td colspan="2" style="padding-top:6px; width:100%;">
                        <div style="width:100%; box-sizing:border-box;">
                            <span t-field="o.remarks"/>
                        </div>
                    </td>
                </tr>
            </table>
            <table style="width: 100%;" class="table table-borderless">
                <tbody>
                    <br/>
                    <tr>
                        <td style="padding: 2px 4px;width:15%;">Project Name</td>
                        <td style="padding: 2px 4px;width:2%;;">:</td>
                        <td style="padding: 2px 4px;width:83%;">
                            <span t-field="o.project"/>
<!--                            <span t-if="o.invoice_line_ids.sale_line_ids.order_id.project"-->
<!--                                  t-field="o.invoice_line_ids.sale_line_ids.order_id.project"/>-->
                        </td>
                    </tr>
                </tbody>
            </table>
        </xpath>

        <xpath expr="//table[@class=' table-borderless table-sm']/tr/td[@class='text-start']/table[@class='table-borderless']/tr[1]"
               position="replace">
            <t t-set="first_do"
               t-value="o.invoice_origin and env['stock.picking'].search([('origin', '=', o.invoice_origin)], limit=1)"/>
            <tr>
                <td name="invoice_number" style="padding: 2px 4px;">Invoice No</td>
                <td style="padding: 2px 4px;">:</td>
                <td style="padding: 2px 4px;">
                    <span t-esc="first_do.name if first_do else ''"/>
                </td>
            </tr>
        </xpath>

        <xpath expr="//table[@name='exchange_rate_table']" position="replace"/>

        <xpath expr="//table[@class=' table-borderless table-sm']/tr/td[@class='text-start']/table[@class='table-borderless']/tr[5]"
               position="after">

            <t t-if="o.our_ref_no">
                <tr>
                    <td style="padding: 2px 4px;">Our Reference No</td>
                    <td style="padding: 2px 4px;">:</td>
                    <td style="padding: 2px 4px;">
                        <span t-field="o.our_ref_no"/>
                    </td>
                </tr>
            </t>
        </xpath>

        <xpath expr="//td[@name='account_invoice_line_name']" position="replace">
            <td name="account_invoice_line_name">
                <t t-if="line.ref">
                    <span>Your PO No:</span>
                    <span t-field="line.ref"/>
                    <br/>
                </t>

                <t t-if="line.name">
                    <span t-field="line.name" t-options="{'widget': 'text'}"/>
                    <br/>
                </t>

                <t t-if="line.product_id.hs_code">
                    <span>HS Code :</span>
                    <span t-field="line.product_id.hs_code"/>
                    <br/>
                </t>

                <t t-if="line.product_id.country_of_origin">
                    <span>COO :</span>
                    <span t-field="line.product_id.country_of_origin"/>
                    <br/>
                </t>
            </td>
        </xpath>

        <xpath expr="//div[@name='comment']" position="after">

            <table class="table" style="width:100%; border: 1px solid black;" name="table_info">
                <tr>
                    <td>
                        <table style="width:100%;" class="table-borderless invoice_delivery">
                            <tr>
                                <!-- Left column -->
                                <td style="vertical-align: top; width: 20%;">
                                    <table name="exchange_rate_table_export_invoice">
                                        <tr>
                                            <td style="padding: 2px 4px;white-space: nowrap;">
                                                <strong>Based on Exchange Rate :</strong>
                                                <span>1</span>
                                                    <span t-field="o.company_currency_id"/>
                                                    <span>=</span>
                                                    <span t-field="o.invoice_currency_rate" t-options='{"widget": "float", "precision": 4}'/>
                                                    <span t-field="o.currency_id"/>
                                            </td>
                                            <td style="padding: 2px 4px;white-space: nowrap;">
                                                <strong>Untaxed Amount :</strong>
                                                <t t-if="is_export_invoice or is_commercial_invoice">
                                                    <t t-set="tax_totals" t-value="o.tax_totals_without_dp"/>
                                                </t>
                                                <t t-else="">
                                                    <t t-set="tax_totals" t-value="o.tax_totals"/>
                                                </t>
                                                <t t-if="tax_totals and tax_totals.get('subtotals')">
                                                    <t t-foreach="tax_totals['subtotals']" t-as="subtotal">
                                                        <span t-out="subtotal['base_amount']"
                                                              t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>
                                                    </t>
                                                </t>
                                            </td>
                                            <td style="padding: 2px 4px;">
                                            </td>
                                        </tr>
                                    </table>
                                    <br/>

                                    <table style="width: 100%;">
                                        <tr>
                                            <td style="padding: 2px 4px;">
                                                <strong>Vessel/ Flight Name</strong>
                                            </td>
                                            <td style="padding: 2px 4px;">:</td>
                                            <td style="padding: 2px 4px;">
                                                <span t-field="o.vessel_name"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 2px 4px; white-space: nowrap;">
                                                <strong>Port/ Airport Of Discharge</strong>
                                            </td>
                                            <td style="padding: 2px 4px;">:</td>
                                            <td style="padding: 2px 4px;">
                                                <span t-field="o.port_discharge_id"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 2px 4px;">
                                                <strong>No. Of Package</strong>
                                            </td>
                                            <td style="padding: 2px 4px;">:</td>
                                            <td style="padding: 2px 4px;">
                                                <span t-field="o.no_of_package"/>
                                            </td>
                                        </tr>
                                        <tr t-if="o.invoice_incoterm_id.name or o.incoterm_location">
                                            <td style="padding: 2px 4px;">
                                                <strong>Shipping Terms</strong>
                                            </td>
                                            <td style="padding: 2px 4px;">:</td>
                                            <td style="padding: 2px 4px;">
                                                <t t-if="o.invoice_incoterm_id.name">
                                                    <span t-field="o.invoice_incoterm_id.name"/>
                                                </t>
                                                <t t-if="o.invoice_incoterm_id.name and o.incoterm_location">,</t>
                                                <t t-if="o.incoterm_location">
                                                    <span t-field="o.incoterm_location"/>
                                                </t>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 2px 4px; white-space: nowrap;">
                                                <strong>Packing Details</strong>
                                            </td>
                                            <td style="padding: 2px 4px;">:</td>
                                            <td style="padding: 2px 4px;">
                                                <span t-field="o.packing_details"/>
                                            </td>
                                        </tr>
                                    </table>
                                </td>

                                <!-- Right column -->
                                <td style="vertical-align: top; width: 50%;">
                                    <table name="table_gst_info">
                                        <tr>
                                            <td style="padding: 2px 4px;white-space: nowrap;">
                                                <t t-foreach="subtotal['tax_groups']" t-as="tax_group">
                                                    <t t-if="same_tax_base or tax_group['display_base_amount'] is None">
                                                        <span class="text-nowrap"
                                                              t-out="tax_group['group_name']"/>
                                                        <span class="text-nowrap"
                                                              t-out="tax_group['tax_amount']"
                                                              t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'
                                                        >31.05
                                                        </span>
                                                    </t>
                                                    <t t-else="">
                                                        <strong>GST Amount :</strong>
<!--                                                        <span class="text-nowrap"-->
<!--                                                              t-out="tax_group['display_base_amount']"-->
<!--                                                              t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'-->
<!--                                                        >27.00-->
<!--                                                        </span>-->
                                                        <span class="text-nowrap"
                                                              t-out="tax_group['tax_amount']"
                                                              t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'
                                                        >4.05
                                                        </span>
                                                    </t>
                                                </t>
                                                <td style="padding: 2px 4px;white-space: nowrap;">
                                                    <strong>Total:</strong>
                                                    <span t-out="tax_totals['total_amount']"
                                                            t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'
                                                    >31.05
                                                    </span>
                                                </td>
                                            </td>
                                            <td style="padding: 2px 4px;">
                                            </td>
                                        </tr>
                                    </table>
                                    <br/>

                                    <table style="width: 100%;">
                                        <tr>
                                            <td style="padding: 2px 20%;">
                                                <strong>Seal No</strong>
                                            </td>
                                            <td style="padding: 2px 4px;position: relative;left: -50px;">:</td>
                                            <td style="padding: 2px 4px;position: relative;left: -50px;">
                                                <span t-field="o.seal_no"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 2px 20%;">
                                                <strong>Container No</strong>
                                            </td>
                                            <td style="padding: 2px 4px;position: relative;left: -50px;">:</td>
                                            <td style="padding: 2px 4px;position: relative;left: -50px;">
                                                <span t-field="o.container_no"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 2px 20%;">
                                                <strong>L/C No</strong>
                                            </td>
                                            <td style="padding: 2px 4px;position: relative;left: -50px;">:</td>
                                            <td style="padding: 2px 4px;position: relative;left: -50px;">
                                                <span t-field="o.lc_no"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 2px 20%;">
                                                <strong>ETD Origin</strong>
                                            </td>
                                            <td style="padding: 2px 4px;position: relative;left: -50px;">:</td>
                                            <td style="padding: 2px 4px;position: relative;left: -50px;">
                                                <span t-field="o.etd_origin"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 2px 20%; white-space: nowrap;">
                                                <strong>ETA Destination</strong>
                                            </td>
                                            <td style="padding: 2px 4px;position: relative;left: -50px;">:</td>
                                            <td style="padding: 2px 4px;position: relative;left: -50px;">
                                                <span t-field="o.eta_destination"/>
                                            </td>
                                        </tr>
                                        <tr t-if="o.country_of_origin_id">
                                            <td style="padding: 2px 20%; white-space: nowrap;">
                                                <strong>Country of Origin</strong>
                                            </td>
                                            <td style="padding: 2px 4px;position: relative;left: -50px;">:</td>
                                            <td style="padding: 2px 4px;position: relative;left: -50px;">
                                                <span t-field="o.country_of_origin_id"/>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr name="information_tr" style="border: 1px solid black;">
                    <td style="border: 1px solid black;">
                        <table style="width: 74%;" class="table-borderless">
                            <tr>
                                <td style="padding: 2px 4px;">
                                    <strong>Remarks</strong>
                                </td>
                                <td style="padding: 2px 4px;">:</td>
                                <td style="padding: 2px 4px;">
                                    <span t-field="o.invoice_remarks" widget="html"/>
                                </td>
                            </tr>

                            <tr t-if="o.forwarder">
                                <td style="padding: 2px 4px;">
                                    <strong>Forwarder</strong>
                                </td>
                                <td style="padding: 2px 4px;">:</td>
                                <td style="padding: 2px 4px;">
                                    <span t-esc="o.forwarder.name"/>
                                    <br/>
                                    <span t-field="o.forwarder"
                                          t-options="{'widget': 'contact', 'fields': ['address'], 'no_marker': true } "/>
                                </td>
                            </tr>

                            <tr>
                                <td style="padding: 2px 4px;">
                                    <strong>Contact</strong>
                                </td>
                                <td style="padding: 2px 4px;">:</td>
                                <td style="padding: 2px 4px;">
                                    <span t-field="o.forwarder.phone"/>
                                </td>
                            </tr>

                            <tr>
                                <td style="padding: 2px 4px;">
                                    <strong>Email</strong>
                                </td>
                                <td style="padding: 2px 4px;">:</td>
                                <td style="padding: 2px 4px;">
                                    <span t-field="o.forwarder.email"/>
                                </td>
                            </tr>

                        </table>
                    </td>
                </tr>
            </table>
            <br/>
            <table name="bank_details_table" style="width:100%;" class="table-borderless">
                <tr>
                    <td style="vertical-align: top; text-align: left; width: 70%;">
                        <t t-if="o.move_type != 'out_refund'">
                            <t t-if="o.partner_bank_id">
                                <t t-foreach="o.partner_bank_id[:2]" t-as="bank">
                                    <table class="table-borderless">
                                        <tr>
                                            <td style="padding: 2px 4px;">Our Banker</td>
                                            <td style="padding: 2px 4px;">:</td>
                                            <td style="padding: 2px 4px;">
                                                <t t-if="bank.bank_id.name">
                                                    <span t-esc="bank.bank_id.name"/>
                                                </t>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 2px 4px;">Currency</td>
                                            <td style="padding: 2px 4px;">:</td>
                                            <td style="padding: 2px 4px;">
                                                <t t-if="bank.bank_id.name">
                                                    <span t-esc="bank.currency_id.name"/>
                                                </t>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 2px 4px;">A/C No</td>
                                            <td style="padding: 2px 4px;">:</td>
                                            <td style="padding: 2px 4px;">
                                                <t t-if="bank.acc_number">
                                                    <span t-esc="bank.acc_number"/>
                                                </t>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 2px 4px;">Swift Code</td>
                                            <td style="padding: 2px 4px;">:</td>
                                            <td style="padding: 2px 4px;">
                                                <t t-if="bank.bank_id.bic">
                                                    <span t-esc="bank.bank_id.bic"/>
                                                </t>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 2px 4px; white-space: nowrap;">Bank Address</td>
                                            <td style="padding: 2px 4px;">:</td>
                                            <td style="padding: 2px 4px;">
                                                <t t-set="bank_address_parts" t-value="[
                                                    bank.bank_id.street,
                                                    bank.bank_id.street2,
                                                    bank.bank_id.city,
                                                    bank.bank_id.zip,
                                                    bank.bank_id.country.name if bank.bank_id.country else ''
                                                ]"/>
                                                <span t-esc="' '.join(filter(None, bank_address_parts))"/>
                                            </td>
                                        </tr>
                                    </table>
                                </t>
                            </t>
                        </t>
                    </td>

                    <td style="vertical-align: top; text-align: right; width: 30%;">
                        <div style="padding-right: 5%;">
                            <strong>AUTHORIZED SIGNATURE</strong>
                        </div>
                        <br/>
                        <br/>
                        <br/>
                        <br/>
                        <br/>
                        <strong t-field="o.company_id.name" style="white-space: nowrap;"/>
                    </td>
                </tr>
            </table>
            <br/>
            <table style="width:100%;" class="table-borderless" name="note_for_bank">
                <tr style="width:100%;">
                    <td style="padding: 2px 4px;width: 11.5%;">Note</td>
                    <td style="padding: 2px 4px;">:</td>
                    <td style="padding: 2px 4px;">
                        <p>Be Sure To Instruct Your Bank That "All Bank Fees Are For Your Account". Lingjack Will Not Be Responsible For Any Bank Fees.
                        </p>
                    </td>
                </tr>
            </table>
        </xpath>
<!--        <xpath expr="//table[@name='table_bank_details']" position="replace"/>-->


        <xpath expr="//table[@class='o_has_total_table table o_main_table table-borderless mb-0']" position="replace">
            <table class="o_has_total_table table o_main_table table-borderless mb-0" name="invoice_line_table">
                <t t-set="show_discount"
                   t-value="any(line.discount for line in o.invoice_line_ids if line.display_type == 'product' and not line.is_downpayment)"/>

                <thead>
                    <tr>
                        <th name="th_sn" class="text-start">
                            <span>S/N</span>
                        </th>
                        <th name="th_description" class="text-start">
                            <span>Description</span>
                        </th>
                        <th name="th_discount" class="text-start" t-if="show_discount">
                            <span>Disc.%</span>
                        </th>
                        <th name="th_quantity" class="text-end">
                            <span>Quantity</span>
                        </th>
                        <th name="th_priceunit"
                            t-attf-class="text-end text-nowrap {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                            <span>Unit Price</span>
                        </th>
                        <th name="th_subtotal" class="text-end">
                            <span>Amount</span>
                        </th>
                    </tr>
                </thead>

                <tbody class="invoice_tbody">
                    <t t-set="current_subtotal" t-value="0"/>
                    <t t-set="current_total" t-value="0"/>
                    <t t-set="sn" t-value="1"/>
                    <t t-set="lines"
                       t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>

                    <t t-foreach="lines" t-as="line">
                        <!-- Skip downpayment lines -->
                        <t t-if="not line.is_downpayment">
                            <t t-if="line.display_type == 'product'">
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal"/>
                                <t t-set="current_total" t-value="current_total + line.price_total"/>

                                <tr>
                                    <td name="td_sn" style="text-align:center">
                                        <t t-esc="sn"/>
                                    </td>
                                    <td name="account_invoice_line_name">
                                        <t t-if="line.ref">
                                            <span>Your PO No:</span>
                                            <span t-field="line.ref"/>
                                            <br/>
                                        </t>
                                        <t t-if="line.name">
                                            <span t-field="line.name" t-options="{'widget': 'text'}"/>
                                            <br/>
                                        </t>

                                        <t t-if="line.product_id.hs_code">
                                            <span>HS Code :</span>
                                            <span t-field="line.product_id.hs_code"/>
                                            <br/>
                                        </t>

                                        <t t-if="line.product_id.country_of_origin">
                                            <span>COO :</span>
                                            <span t-field="line.product_id.country_of_origin"/>
                                            <br/>
                                        </t>
                                    </td>

                                    <td name="td_discount" class="o_td_discount text-start" t-if="show_discount">
                                        <span t-field="line.discount" class="text-nowrap"/>
                                    </td>

                                    <td name="td_quantity" class="o_td_quantity text-end" style="white-space: nowrap;">
                                        <span t-field="line.quantity" class="text-nowrap"/>
                                        <span t-field="line.product_uom_id" groups="uom.group_uom"/>
                                    </td>

                                    <td name="td_price_unit"
                                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span class="text-nowrap">
                                            <span t-field="line.price_unit"
                                                  t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                        </span>
                                    </td>

                                    <td name="td_subtotal" class="text-end o_price_total">
                                        <span class="text-nowrap" t-field="line.price_subtotal"/>
                                    </td>
                                </tr>
                                <t t-set="sn" t-value="sn+1"/>
                            </t>

                            <t t-elif="line.display_type == 'line_section' and line.name != 'Down Payments'">
                                <tr class="fw-bold o_line_section">
                                    <td colspan="99">
                                        <span t-if="line.name" t-field="line.name" t-options="{'widget': 'text'}"/>
                                    </td>
                                </tr>
                                <t t-set="current_section" t-value="line"/>
                                <t t-set="current_subtotal" t-value="0"/>
                            </t>

                            <t t-elif="line.display_type == 'line_note'">
                                <tr class="fst-italic o_line_note">
                                    <td colspan="99">
                                        <span t-if="line.name" t-field="line.name" t-options="{'widget': 'text'}"/>
                                    </td>
                                </tr>
                            </t>
                        </t>
                    </t>
                </tbody>
            </table>
        </xpath>

        <xpath expr="/t[@t-name='lingjack_print.report_tax_invoice_document']/t/div[@class='page']/table[@class='table-borderless']"
               position="replace"/>

        <xpath expr="//div[@id='qrcode']" position="replace"/>

        <xpath expr="//div[@class='row']/span[normalize-space(text())='This is computer generated invoice. No signature required.']"
               position="replace"/>

        <xpath expr="//div[@id='right-elements']" position="replace">
            <div id="right-elements"
                 t-attf-class="#{'col-5 mt-5' if report_type == 'pdf' else 'col-12 col-md-5'} ms-5 d-inline-block float-end">
                <div id="total" class="clearfix row">
                    <div class="ms-auto">
                        <table class="o_total_table table table-borderless avoid-page-break-inside">
                            <!--                             Tax totals summary (invoice currency)-->
                            <!--                                <t t-if="o.tax_totals_without_dp" t-call="account.document_tax_totals">-->
                            <!--                                <t t-set="tax_totals" t-value="o.tax_totals_without_dp"/>-->
                            <!--                            <t t-if="o.tax_totals" t-call="account.document_tax_totals">-->
                            <!--                                <t t-set="tax_totals" t-value="o.tax_totals"/>-->
                            <!--                                <t t-set="currency" t-value="o.currency_id"/>-->
                            <!--                            </t>-->


                            <t t-if="is_export_invoice or is_commercial_invoice">
                                <t t-if="o.tax_totals_without_dp">
                                    <t t-call="account.document_tax_totals">
                                        <t t-set="tax_totals" t-value="o.tax_totals_without_dp"/>
                                        <t t-set="currency" t-value="o.currency_id"/>
                                    </t>
                                </t>
                            </t>

                            <t t-if="is_export_tax_invoice">
                                <t t-if="o.tax_totals">
                                    <t t-call="account.document_tax_totals">
                                        <t t-set="tax_totals" t-value="o.tax_totals"/>
                                        <t t-set="currency" t-value="o.currency_id"/>
                                    </t>
                                </t>
                            </t>

                            <!--Payments-->
                            <t t-if="print_with_payments">
                                <t t-if="o.payment_state != 'invoicing_legacy'">
                                    <t t-set="payments_vals"
                                       t-value="o.sudo().invoice_payments_widget and o.sudo().invoice_payments_widget['content'] or []"/>
                                    <t t-foreach="payments_vals" t-as="payment_vals">
                                        <tr t-if="payment_vals['is_exchange'] == 0">
                                            <td>
                                                <i class="oe_form_field text-end oe_payment_label">
                                                    <t t-if="payment_vals['is_refund']">Reversed on</t>
                                                    <t t-else="">Paid on</t>
                                                    <t t-out="payment_vals['date']" t-options='{"widget": "date"}'>
                                                        2021-09-19
                                                    </t>
                                                </i>
                                            </td>
                                            <td class="text-end">
                                                <span t-out="payment_vals['amount']"
                                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'>
                                                    20.00
                                                </span>
                                            </td>
                                        </tr>
                                    </t>
                                    <t t-if="len(payments_vals) > 0">
                                        <tr class="fw-bold">
                                            <td>Amount Due</td>
                                            <td class="text-end">
                                                <span t-field="o.amount_residual">11.05</span>
                                            </td>
                                        </tr>
                                    </t>
                                </t>
                            </t>
                        </table>
                    </div>
                </div>
                <div class="mb-2">
                    <p class="text-end lh-sm" t-if="o.company_id.display_invoice_amount_total_words">
                        Total amount in words:
                        <br/>
                        <small class="text-muted lh-sm">
                            <span t-field="o.amount_total_words">Thirty one dollar and Five cents</span>
                        </small>
                    </p>
                </div>

                <!-- Tax totals summary (company currency) -->
                <t t-if="o.tax_totals_without_dp.get('display_in_company_currency')">
                    <t t-set="tax_totals" t-value="o.tax_totals_without_dp"/>
                </t>
                <t t-else="">
                    <div class="oe_structure"/>
                </t>
            </div>
        </xpath>
    </template>

    <template id="account.document_tax_totals" inherit_id="account.document_tax_totals_template" primary="True">
        <xpath expr="//tr[@class='o_subtotal']" position="before">
            <tr t-if="is_export_invoice or is_export_tax_invoice or is_commercial_invoice">
                <td style="white-space: nowrap;">Untaxed Amount Before Discount</td>
                <td class="text-end">
                    <t t-if="is_export_tax_invoice">
                        <span t-esc="o.currency_id.round(
                            sum(
                                (line.price_unit * line.quantity)
                                for line in o.invoice_line_ids
                                if 'Discount' not in (line.name or '').title()
                            )
                        )" t-options='{"widget": "monetary", "display_currency": currency}'/>
                    </t>

                    <t t-elif="is_export_invoice or is_commercial_invoice">
                        <span t-esc="o.currency_id.round(
                            sum((line.price_unit * line.product_uom_qty)
                                for line in o.env['sale.order'].search([('name', '=', o.invoice_origin)]).order_line
                                if 'Discount' not in (line.name or '').title()))"
                              t-options='{"widget": "monetary", "display_currency": currency}'/>
                    </t>
                </td>
            </tr>
        </xpath>
        <xpath expr="//tr[@class='o_subtotal']//td//span" position="replace">
            <t t-if="is_export_invoice or is_export_tax_invoice or is_commercial_invoice">
                <span>Untaxed Amount After Discount</span>
            </t>
            <t t-else="">
                <span>Untaxed Amount</span>
            </t>
        </xpath>
    </template>


    <template id="export_invoice">
        <t t-call="web.html_container">
            <t t-set="is_export_invoice" t-value="true"/>
            <t t-foreach="docs" t-as="o">
                <t t-set="lang" t-value="o.partner_id.lang"/>
                <t t-call="lingjack_print.report_export_invoice_document" t-lang="lang"/>
            </t>
        </t>
    </template>

    <record id="action_export_invoice" model="ir.actions.report">
        <field name="name">Export Invoice</field>
        <field name="model">account.move</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">lingjack_print.export_invoice</field>
        <field name="report_file">lingjack_print.export_invoice</field>
        <field name="print_report_name">'Export Invoice - %s' % (object.name)</field>
        <field name="binding_model_id" ref="account.model_account_move"/>
        <field name="binding_type">report</field>
    </record>
</odoo>
